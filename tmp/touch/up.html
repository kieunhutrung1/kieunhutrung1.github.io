<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Thao tÃ¡c update.lua thá»§ cÃ´ng</title>
  <style>
    button {
      display: block;
      margin: 10px 0;
      padding: 12px 16px;
      font-size: 16px;
      width: 100%;
    }
  </style>
</head>
<body>
  <h2>ğŸ”§ Quáº£n lÃ½ update.lua (thá»§ cÃ´ng)</h2>

  <button onclick="deleteFile()">âŒ XÃ“A update.lua</button>
  <button onclick="createFile()">ğŸ“„ Táº O file má»›i</button>
  <button onclick="writeFile()">âœï¸ GHI ná»™i dung Lua</button>

  <p id="status">ğŸ‘‰ Chá»n thao tÃ¡c bÃªn trÃªn.</p>

  <script>
    const server = "http://192.168.2.222:8080";

    const luaCode = `
toast("Script tá»« Safari iPhone Ä‘ang cháº¡y...");

local url = "https://kieunhutrung1.github.io/hide/debs/update.zip"
local zipPath = rootDir() .. "/update.zip"
local extractTo = rootDir()

function fileExists(path)
  local f = io.open(path, "r")
  if f then f:close(); return true end
  return false
end

toast("Äang táº£i file...")
local cmd = string.format('curl -k -L "%s" -o "%s"', url, zipPath)
execute(cmd)

if fileExists(zipPath) then
  execute("rm -r "..rootDir() .."/Debug/*")
  execute("rm -r "..rootDir() .."/img/*")
  execute("rm -r "..rootDir() .."/libs/*")
  toast("Táº£i thÃ nh cÃ´ng!", 2)
  local unzipCmd = string.format('unzip -o "%s" -d "%s"', zipPath, extractTo)
  execute(unzipCmd)
  toast("Giáº£i nÃ©n xong!", 5)
  os.remove(zipPath)
else
  toast("KhÃ´ng tÃ¬m tháº¥y file sau khi táº£i!", 5)
end
`;

    function setStatus(msg) {
      document.getElementById("status").innerText = msg;
    }

    function deleteFile() {
      fetch(`${server}/file/delete?path=/update.lua`)
        .then(() => setStatus("âœ… ÄÃ£ gá»i xoÃ¡ update.lua"))
        .catch(err => setStatus("âŒ Lá»—i xoÃ¡: " + err));
    }

    function createFile() {
      fetch(`${server}/file/new?path=/update.lua`)
        .then(() => setStatus("âœ… ÄÃ£ táº¡o file update.lua má»›i"))
        .catch(err => setStatus("âŒ Lá»—i táº¡o: " + err));
    }

    function writeFile() {
      fetch(`${server}/file/update?path=/update.lua`, {
        method: "POST",
        headers: { "Content-Type": "text/plain" },
        body: luaCode
      })
        .then(() => setStatus("âœ… ÄÃ£ ghi ná»™i dung má»›i vÃ o update.lua"))
        .catch(err => setStatus("âŒ Lá»—i ghi: " + err));
    }
  </script>
</body>
</html>
