<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Copy Script</title>
  <style>
    body {
      font-family: monospace;
      background: #f9f9f9;
      padding: 40px;
    }
    textarea {
      width: 100%;
      height: 400px;
      padding: 10px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 5px;
      resize: vertical;
      box-sizing: border-box;
    }
    button {
      margin-top: 10px;
      padding: 10px 20px;
      background: #28a745;
      color: white;
      border: none;
      font-size: 14px;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background: #218838;
    }
  </style>
</head>
<body>
  <h2>üìã AutoTouch Lua Script</h2>
  <textarea id="code" readonly>
local curl = require("cURL")
local zipUrl = "https://kieunhutrung1.github.io/tmp/touch/update.zip"
local zipPath = rootDir() .. "/update.zip"
local extractTo = rootDir()  -- Gi·∫£i n√©n ngay t·∫°i th∆∞ m·ª•c root

function downloadZip(url, savePath)
    local file = io.open(savePath, "wb")
    if not file then
        toast("‚ùå Kh√¥ng th·ªÉ t·∫°o file!", 5)
        return false
    end
    local c = curl.easy{
        url = url,
        writefunction = function(chunk)
            file:write(chunk)
            return #chunk
        end
    }
    c:setopt(curl.OPT_SSL_VERIFYPEER, false)
    c:setopt(curl.OPT_FOLLOWLOCATION, 1)
    c:setopt(curl.OPT_TIMEOUT, 20)

    local ok, err = pcall(function()
        c:perform()
    end)

    c:close()
    file:close()

    if ok then
        toast("‚úÖ T·∫£i th√†nh c√¥ng!", 2)
        return true
    else
        toast("‚ùå L·ªói khi t·∫£i: " .. tostring(err), 5)
        return false
    end
end

function unzipFile(zipFile, toFolder)
    local cmd = string.format('unzip -o "%s" -d "%s"', zipFile, toFolder)
    local result = execute(cmd)
    toast("‚úÖ Gi·∫£i n√©n th√†nh c√¥ng!", 3)
end

if downloadZip(zipUrl, zipPath) then
    unzipFile(zipPath, extractTo)
end
  </textarea>
  <button onclick="copyCode()">üìã Copy</button>

  <script>
    function copyCode() {
      const textArea = document.getElementById("code");
      textArea.select();
      document.execCommand("copy");
    }
  </script>
</body>
</html>
